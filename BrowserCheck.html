<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <!--<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />-->
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="renderer" content="ie-stand"><!-- 浏览器内核控制Meta标签说明文档 http://se.360.cn/v6/help/meta.html //-->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>浏览器配置检测（主站点测试）</title>  
    
    <!-- 开发
        <script src="Scripts/jquery-1.7.1.js" type="text/javascript"></script>
        <script src="Scripts/jquery.cookie.js" type="text/javascript"></script>
        <script src="Scripts/jquery.blockUI.js" type="text/javascript"></script>
        <script src="Scripts/jquery.ua.js" type="text/javascript"></script>
        <script src="Scripts/console.js" type="text/javascript"></script>
    //-->
    <!-- 正式部署  //-->
    <script type="text/javascript" src="http://mis.msdi.cn/share/js/jQuery/jquery.min.js?v=1.7.2"></script>
    <script type="text/javascript" src="http://mis.msdi.cn/share/js/jQuery/jquery.ui.all.js?v=1.8.21"></script>
    <script type="text/javascript" src="http://mis.msdi.cn/share/js/jQuery/jquery.cookie.js?v=1.3.1"></script>
    <script type="text/javascript" src="http://mis.msdi.cn/share/js/jQuery/jquery.blockUI.js?v=2.66"></script>
    <script type="text/javascript" src="http://mis.msdi.cn/share/js/jQuery/plugins/jquery.ua.min.js?v=1.2"></script>
    <script type="text/javascript" src="http://mis.msdi.cn/share/js/jQuery/plugins/console.js?v=0.1"></script>
    
    <script type="text/javascript" src="utils.js"></script>
    <script type="text/javascript" src="config.js"></script>
    <script type="text/javascript">
        //常量
        var StatusNG = 0;
        var StatusUP = 1;
        var StatusOK = 2;

        var WIN32 = "Win32";
        var WIN64 = "Win64";
        var FLASHMINVER = "11.0"; // Flash的最低版本要求
        var SLIVERLIGHTMINVER = "4.0"; // Sliverlight

        var ContextPath = window.location.protocol + "//" + window.location.host +
        (window.location.pathname.lastIndexOf("/") > 0 ? (window.location.pathname.substring(0, window.location.pathname.lastIndexOf("/") + 1)) : "/");
        
        //检测项目
        var IdxBrowser = 0; //浏览器
        var IdxJs = 1;  //JavaScript是否启用
        var IdxCookie = 2;
        var IdxPopup = 3;
        var IdxFlash = 4;   //COA附件上传
        var IdxJre = 5;
        var IdxZone = 6;
        var IdxAllowFullsize = 7;   //全屏
        var IdxDecidePopupByIE = 8;;
        var IdxSliverlight = 9; //附件上传
        var IdxOtherSystem = 10;    //其他域名的检测
    </script>

    <script type="text/javascript">
        /**
        *区分各类浏览器
        *    IE8 使用兼容模式后在检测的时候就变成了IE7
        */
        var Sys = {
            ie: 0,
            firefox: 0,
            chrome: 0,
            opera: 0,
            safari: 0,
            win32: true,
            trusted: false, //是否为受信站点
            javascript: true, //是否允许执行JS（多余的检测项）
            popup: false, //浏览器弹出窗口状态
            popupIE: false, //注册表中IE的设置
            //showTool:false,//突出显示 修复工具
            ua: ""
        };   //区分各类浏览器
        
        function InitialInfo() {
            var ua = navigator.userAgent.toLowerCase();
            var s;
//            (s = ua.match(/msie ([\d.]+)/)) ? Sys.ie = s[1] :
//                (s = ua.match(/trident 7.0/)) ? Sys.ie = 11.0 :
//                    (s = ua.match(/firefox\/([\d.]+)/)) ? Sys.firefox = s[1] :
//                        (s = ua.match(/chrome\/([\d.]+)/)) ? Sys.chrome = s[1] :
//                            (s = ua.match(/opera.([\d.]+)/)) ? Sys.opera = s[1] :
//                                (s = ua.match(/version\/([\d.]+).*safari/)) ? Sys.safari = s[1] : 0;
            Sys.ua = ua;
            if ($.ua().isIe) {//准确地处理IE兼容模式
                Sys.ie = $.ua().ie;
                Sys.win32 = window.navigator.platform == WIN32 ? true : false;//64位操作系统中执行32位IE返回值为 Win32，否则为 Win64
            } else if ($.ua().isFirefox) {
                Sys.firefox = $.ua().engine.version;
            //} else if ($.ua().isChrome || $.ua().is360ee || $.ua().is360se || $.ua().isLiebao || $.ua().isSougou) {
            //    Sys.chrome = $.ua().engine.version;
            } else if (s = ua.match(/chrome\/([\d.]+)/)) {
                Sys.chrome = s[1];
            } else if(s = ua.match(/opera.([\d.]+)/)){
                Sys.opera = s[1];
            } else if(s = ua.match(/version\/([\d.]+).*safari/)) {
                Sys.safari = s[1];
            }

            //IE下的检查
            if (Sys.ie) {
                IeCheck();
            }
            //中南院的业务系统暂不支持非IE浏览器
//            else if (Sys.chrome) {
//                ChromeCheck();
//            }
//            else if (Sys.safari) {
//                SafariCheck();
//            }
//            else if (Sys.firefox) {
//                FireFoxCheck();
//            }
            else {
                $("#browserInfo").hide();
                //$("#browserSet").hide();

                //如果是识别为Chrome则有可能是国产的双核浏览器，需要另外提示
                if ($.ua().isWebkit && !Sys.safari) {
                    var UA = navigator.userAgent.toLowerCase();
                    var majorVer = $.ua().browser && $.ua().browser.version && $.ua().browser.version.split('.').length ?
                        $.ua().browser.version.split('.')[0] : 0;
                    var browserName = 
                            $.ua().isSougou ? "搜狗浏览器" :
                            $.ua().isLiebao ? "猎豹浏览器" :
                            (UA.indexOf('aoyou') > -1) ? '遨游浏览器' : //'遨游浏览器' :
                            (UA.indexOf('theworld') > -1) ? '世界之窗浏览器' : //'世界之窗浏览器' :
                            (UA.indexOf('worldchrome') > -1) ? '世界之窗极速浏览器' : //'世界之窗极速浏览器' :
                            (UA.indexOf('greenbrowser') > -1) ? '绿色浏览器' : //'绿色浏览器' :
                            (UA.indexOf('qqbrowser') > -1) ? 'QQ浏览器' : //'QQ浏览器' :
                            (UA.indexOf('baidu') > -1) ? '百度浏览器' : //'百度浏览器' :
                    //(UA.indexOf('se') > -1) ? '搜狗浏览器' : //'搜狗浏览器' :
                            ($.ua().is360ee && majorVer<32) ? "360极速浏览器" :
                            ($.ua().is360se && majorVer<32) ? "360安全浏览器" :
                            null //剩余的情况为“谷歌浏览器”;
                        ;
                    if(browserName)
                        alert("检测到你正在使用 “" + browserName + "”，请切换至兼容模式再进行检测。");
                    else {
                        alert("系统暂不支持您当前使用的浏览器！请选择推荐的“微软IE浏览器”");    
                    }
                } else {
                    SetResultCookies(-1);
                    alert("系统暂不支持您当前使用的浏览器！请选择推荐的“微软IE浏览器”。");
                }
            }
        }

        //Javascript脚本支持，该检测有点多余
        function JsCheck(browser, index) {
            var jsStatus = true;
            if (jsStatus) {
                $("#" + browser + "BrowserRet" + index).html("成功");
                $("#" + browser + "BrowserRet" + index).css("color", "#008000");
            }
            else {
                $("#" + browser + "BrowserRet" + index).html("失败");
                $("#" + browser + "BrowserRet" + index).css("color", "red");
                $("#" + browser + "BrowserRet" + index).parent().css("background-color", "rgb(248, 214, 214)");

                $("#" + browser + "BrowserSuggest" + index).html("点击设置");
                $("#" + browser + "BrowserSuggest" + index).attr("href", "");
                $("#" + browser + "BrowserSuggest" + index).click(function() {
                    TipShow(this, browser + 'jsset', "允许Javascript"); return false;
                });
            }
            return true;
        }

        //可信站点检测
        function TrustWebSiteCheck(browser, index) {
            var trust = false;
            if (getTrustWebsiteStatus() == 2) {
                $("#" + browser + "BrowserRet" + index).html("成功");
                $("#" + browser + "BrowserRet" + index).css("color", "#008000");
                trust = true;
            }
            else {
                $("#" + browser + "BrowserRet" + index).html("失败");
                $("#" + browser + "BrowserRet" + index).css("color", "red");
                $("#" + browser + "BrowserRet" + index).parent().css("background-color", "rgb(248, 214, 214)");

                $("#" + browser + "BrowserSuggest" + index).html("点击设置");
                $("#" + browser + "BrowserSuggest" + index).attr("href", "");
                $("#" + browser + "BrowserSuggest" + index).click(function() {
                    TipShow(this, browser + 'trustwebsiteset', "添加可信站点"); return false;
                });
            }
            return trust;
        }

        //允许由脚本初始化的窗口，没有大小和位置限制
        function AllowFullSizeWindowCheck(browser, index) {
            var allowFull = false;
            if (getAllowFullSizeWindowStatus() == 2) {
                $("#" + browser + "BrowserRet" + index).html("成功");
                $("#" + browser + "BrowserRet" + index).css("color", "#008000");
                allowFull = true;
            }
            else {
                $("#" + browser + "BrowserRet" + index).html("失败");
                $("#" + browser + "BrowserRet" + index).css("color", "red");
                $("#" + browser + "BrowserRet" + index).parent().css("background-color", "rgb(248, 214, 214)");

                $("#" + browser + "BrowserSuggest" + index).html("点击设置");
                $("#" + browser + "BrowserSuggest" + index).attr("href", "");
                $("#" + browser + "BrowserSuggest" + index).click(function() {
                    TipShow(this, browser + 'allowfullsizewin', "允许由脚本操作窗口"); return false;
                });
            }
            return allowFull;
        }

        //由Internet Exporer决定如何打开弹出窗口
        function DecidePopupByIECheck(browser, index) {
            var popup = false;
            if (getDecidePopupByIEStatus() == 2) {
                $("#" + browser + "BrowserRet" + index).html("成功");
                $("#" + browser + "BrowserRet" + index).css("color", "#008000");
                popup = true;
            }
            else {
                $("#" + browser + "BrowserRet" + index).html("失败");
                $("#" + browser + "BrowserRet" + index).css("color", "red");
                $("#" + browser + "BrowserRet" + index).parent().css("background-color", "rgb(248, 214, 214)");

                $("#" + browser + "BrowserSuggest" + index).html("点击设置");
                $("#" + browser + "BrowserSuggest" + index).attr("href", "");
                $("#" + browser + "BrowserSuggest" + index).click(function() {
                    TipShow(this, browser + 'decidepopupbyieset', "设置IE弹出窗口选项"); return false;
                });
            }
            return popup;
        }

        //Cookies检测
        function CookieCheck(browser, index) {
            var cookie = false;
            if (getCookieStatus() == 2) {
                $("#" + browser + "BrowserRet" + index).html("成功");
                $("#" + browser + "BrowserRet" + index).css("color", "#008000");
                cookie = true;
            }
            else {
                $("#" + browser + "BrowserRet" + index).html("失败");
                $("#" + browser + "BrowserRet" + index).css("color", "red");
                $("#" + browser + "BrowserRet" + index).parent().css("background-color", "rgb(248, 214, 214)");

                $("#" + browser + "BrowserSuggest" + index).html("点击设置");
                $("#" + browser + "BrowserSuggest" + index).attr("href", "");
                $("#" + browser + "BrowserSuggest" + index).click(function() {
                    TipShow(this, browser + 'cookieset', "设置Cookies"); return false;
                });
            }
            return cookie;
        }

        //弹框检测
        function PopupCheck(browser, index) {
            var popup = false;
            if (getPopupStatus("BrowserCheckClose.html") == 2) {
                $("#" + browser + "BrowserRet" + index).html("成功");
                $("#" + browser + "BrowserRet" + index).css("color", "#008000");
                popup = true;
            }
            else {
                $("#" + browser + "BrowserRet" + index).html("失败");
                $("#" + browser + "BrowserRet" + index).css("color", "red");
                $("#" + browser + "BrowserRet" + index).parent().css("background-color","rgb(248, 214, 214)");

                $("#" + browser + "BrowserSuggest" + index).html("点击设置");
                $("#" + browser + "BrowserSuggest" + index).attr("href", "");
                $("#" + browser + "BrowserSuggest" + index).click(function() {
                    TipShow(this, browser + 'popupset', "禁用弹框阻止程序"); return false;
                });
            }
            return popup;
        }

        //Flash播放器
        function FlashCheck(browser, index) {
            var flash = flash;
            var check = getFlashStatus();
            if (check == StatusOK || check == StatusUP) {
                $("#" + browser + "BrowserRet" + index).html("成功");
                $("#" + browser + "BrowserRet" + index).css("color", "#008000");

                if (check==StatusUP){if(!Sys.chrome) {//Chrome已经内置Flash
                    $("#" + browser + "BrowserSuggest" + index).html("点击下载最新Flash插件");
                    $("#" + browser + "BrowserSuggest" + index).attr("target", "_blank");
                    $("#" + browser + "BrowserSuggest" + index).attr("href", "http://get.adobe.com/cn/flashplayer/");
                }}
                flash = true;
            }
            else {
                $("#" + browser + "BrowserRet" + index).html("失败");
                $("#" + browser + "BrowserRet" + index).css("color", "red");
                $("#" + browser + "BrowserRet" + index).parent().css("background-color", "rgb(248, 214, 214)");

                $("#" + browser + "BrowserSuggest" + index).html("点击下载最新Flash插件");
                $("#" + browser + "BrowserSuggest" + index).attr("target", "_blank");
                $("#" + browser + "BrowserSuggest" + index).attr("href", "http://get.adobe.com/cn/flashplayer/");
            }
            return flash;
        }

        //Sliverlight检测
        function SliverlightCheck(browser, index) {
            var sl = false;
            if (Silverlight.isInstalled(SLIVERLIGHTMINVER)) { // true/false
                $("#" + browser + "BrowserRet" + index).html("成功");
                $("#" + browser + "BrowserRet" + index).css("color", "#008000");
                sl = true;
            }
            else {
                $("#" + browser + "BrowserRet" + index).html("失败");
                $("#" + browser + "BrowserRet" + index).css("color", "red");
                $("#" + browser + "BrowserRet" + index).parent().css("background-color", "rgb(248, 214, 214)");

                $("#" + browser + "BrowserSuggest" + index).html("点击下载最新Sliverlight插件");
                $("#" + browser + "BrowserSuggest" + index).attr("target", "_blank");
                $("#" + browser + "BrowserSuggest" + index).attr("href", "http://www.microsoft.com/getsilverlight/Get-Started/Install/");
            }
            return sl;
        }

        //IE下的检测
        function IeCheck() {
            console.log("执行IE浏览器检测");
            console.log("IE浏览器版本：" + Sys.ie);
            //初始化全局变量
            Sys.popup = false;
            Sys.popupIE = false;
            Sys.trusted = false;

            //alert("系统在检查可信任站点时要运行ActiveX控件,\n\r可能会弹出对话框是允许ActiveX控件与页面交互的确认对话框,\n\r请点击\"确定\"按钮,否则无法对浏览器进行检查.");

            $(".check-browser-ie").show();
            //浏览器版本检测，如果低于IE 7.0 提示不支持，如果是IE 7.0 建议升级到IE 8.0 ，若果是IE 8.0则没有提示
            $("#ieBrowserInfo1").html("Microsoft Internet Explorer " + Sys.ie);
            if (Math.round(Sys.ie) < 7) {
                $("#ieBrowserRet1").css("color", "red");
                $("#ieBrowserRet1").html("失败");

                $("#ieBrowserSuggest1").html("您正在使用的浏览器不被支持建议升级到IE8");
                $("#ieBrowserSuggest1").attr("href", "http://windows.microsoft.com/zh-CN/internet-explorer/downloads/ie-8");
                $("#ieBrowserSuggest1").attr("target", "_blank");
            }
            else {
                $("#ieBrowserRet1").css("color", "#008000");
                $("#ieBrowserRet1").html("成功");
            }

            if (Math.round(Sys.ie) < 8) {
                $("#ieBrowserSuggest1_0").html("建议升级到IE8");
                
                $("#ieBrowserSuggest1_1").html("官方下载地址");                
                $("#ieBrowserSuggest1_1").attr("href", "http://windows.microsoft.com/zh-CN/internet-explorer/downloads/ie-8");
                $("#ieBrowserSuggest1_1").attr("target", "_blank");

                $("#ieBrowserSuggest1_2").html("本地下载(XP 32位)");
                $("#ieBrowserSuggest1_2").attr("href", "http://mis.msdi.cn/Portal/install/ie/IE8-WindowsXP-x86-CHS.exe");
                $("#ieBrowserSuggest1_2").attr("target", "_blank");

            } else if (!Sys.win32) { //如果是64位IE，至少是IE8以上的版本
                $("#ieBrowserRet1").css("color", "lime");
                $("#ieBrowserRet1").html("存在问题");
                $("#ieBrowserRet1").parent().css("background-color", "rgb(248, 214, 214)");

                $("#ieBrowserSuggest1_0").html("请使用32位IE 否则无法使用在线编辑功能");
                $("#ieBrowserSuggest1_3").html("打开32位IE的方法");
                $("#ieBrowserSuggest1_3").attr("href", "");
                $("#ieBrowserSuggest1_3").click(function () {
                    TipShow(this, 'ie32bit', "32位IE浏览器访问方法");return false;
                });
            }

            //Javascript脚本支持，该检测有点多余
            JsCheck("ie", "2");

//            //可信站点检测
//            TrustWebSiteCheck("ie", "3");
//            //允许由脚本初始化的窗口，没有大小和位置限制
//            AllowFullSizeWindowCheck("ie", "4");
//            //由Internet Exporer决定如何打开弹出窗口
//            DecidePopupByIECheck("ie", "5");
//            //Cookies检测
//            CookieCheck("ie", "6");
//            //弹框检测
//            PopupCheck("ie", "7");
//            //Flash播放器
//            FlashCheck("ie", "8");
//            //Sliverlight银光
//            SliverlightCheck("ie", "9");

            //Cookies检测
            CookieCheck("ie", "6");

            var showIeTool = 0; //错误次数
            var popup = false;  
            //可信站点检测
            showIeTool += TrustWebSiteCheck("ie", "3") ? 0 : 1;
            //允许由脚本初始化的窗口，没有大小和位置限制
            showIeTool += AllowFullSizeWindowCheck("ie", "4") ? 0 : 1;
            //由Internet Exporer决定如何打开弹出窗口
            showIeTool += DecidePopupByIECheck("ie", "5") ? 0 : 1;
            //弹框检测
            //弹出窗口的问题需要特殊处理，暂时排除
            PopupCheck("ie", "7");
            //showIeTool += PopupCheck("ie", "7") ? 0 : 1;

            //Flash播放器
            showIeTool += FlashCheck("ie", "8") ? 0 : 1;
            //Sliverlight银光
            showIeTool += SliverlightCheck("ie", "9") ? 0 : 1;

            //其他业务系统配置要求
            OtherSystemCheck("ie", "10");

            if (showIeTool) {
                if (!Sys.trusted && confirm("您的浏览器未设置受信站点，是否下载“常见问题修复工具”帮您自动处理？")) {
                    $("#ietools").click();
                }

                $("#ietools").parent().effect('shake', { times: 60 }, 500);
                SetResultCookies(0);
            } else {
                SetResultCookies(1);
            }

            //针对使用外壳浏览器的用户的情况进行特殊处理
            if (Sys.ie) {
                //如果浏览器不允许弹窗，但是IE设置为允许弹窗则说明用户使用的是外壳浏览器
                if (!Sys.popup && Sys.popupIE) {
                    alert("您正在使用的第三方浏览器 或 插件 阻止了业务系统弹出新窗口，请设置为“允许*.msdi.cn”弹窗。");
                }
            }
        }

        //Chrome下的检测
        function ChromeCheck() {
            Sys.popup = false;

            $(".check-browser-chrome").show();

            //版本检测
            $("#chromeBrowserInfo1").html("Google Chrome " + Sys.chrome);
            $("#chromeBrowserRet1").css("color", "#008000");
            $("#chromeBrowserRet1").html("成功");

            if (Math.round(Sys.chrome.split('.')[0]) < 11) {
                $("#chromeBrowserSuggest1").attr("href", "http://www.google.com/chrome");
                $("#chromeBrowserSuggest1").html("检测到有新版本，点击更新");
                $("#chromeBrowserSuggest1").attr("target", "_blank");
            }
            //Javascript检测
            JsCheck("chrome", "2");
            //Cookies检测
            CookieCheck("chrome", "3");
            //弹框检测
            PopupCheck("chrome", "4");
            //Flash插件检测
            FlashCheck("chrome", "5");
        }

        //Safari下的检测
        function SafariCheck() {
            Sys.popup = false;

            $(".check-browser-safari").show();

            //版本检测
            $("#safariBrowserInfo1").html("Apple Safari " + Sys.safari);
            $("#safariBrowserRet1").css("color", "#008000");
            $("#safariBrowserRet1").html("成功");

            if (Math.round(Sys.safari.split('.')[0]) < 5) { //20140624
                $("#safariBrowserSuggest1").attr("href", "http://www.apple.com.cn/safari/download/");
                $("#safariBrowserSuggest1").html("检测到有新版本，点击更新");
                $("#safariBrowserSuggest1").attr("target", "_blank");
            }
            //Javascript检测
            JsCheck("safari", "2");
            //Cookies检测
            CookieCheck("safari", "3");
            //弹框检测
            PopupCheck("safari", "4");
            //Flash插件检测
            FlashCheck("safari", "5");
        }

        function FireFoxCheck() {
            Sys.popup = false;

            $(".check-browser-firefox").show();

            //版本检测
            $("#firefoxBrowserInfo1").html("Mozilla Firefox " + Sys.firefox);
            $("#firefoxBrowserRet1").css("color", "#008000");
            $("#firefoxBrowserRet1").html("成功");

            if (Math.round(Sys.firefox.split('.')[0]) < 20) { //20140624
                $("#firefoxBrowserSuggest1").attr("href", "http://firefox.com.cn/download");
                $("#firefoxBrowserSuggest1").html("检测到有新版本，点击更新");
                $("#firefoxBrowserSuggest1").attr("target", "_blank");
            }
            //Javascript检测
            JsCheck("firefox", "2");
            //Cookies检测
            CookieCheck("firefox", "3");
            //弹框检测
            PopupCheck("firefox", "4");
            //Flash插件检测
            FlashCheck("firefox", "5");
        }


        function TipClose(obj) {
            $(obj).parent().parent().parent().hide();
        }
        function TipShow(obj, id, title) {
            var imgStr = "<div id=\"";
            imgStr += id;
            imgStr += "\" class=\"checkinfo-area\" style=\"width:764px; position:absolute;\"><div class=\"checkinfo-area-title\"><div onclick=\"TipClose(this)\" style=\"float:right; color:#003299; cursor:pointer;\">关闭</div> <div class=\"zxlm-f14\">";
            imgStr += title;
            imgStr += "</div></div><div class=\"checkinfo-area-content\" ><img id='setimg' src=\"CheckIE/";
            imgStr += id;
            imgStr += ".jpg\" /><span id='loadinginfo'></span></div></div>";

            $("#set").html(imgStr);
            var offset = $(obj).offset();
            $("#set").css({ "top": offset.top + "px", "left": offset.left + "px" });

            $("#" + id).css("width", 100 + "px");
            $("#loadinginfo").html("正在加载……");
            $("#setimg").load(function() {
                $("#loadinginfo").html("");
                $("#set").fadeIn(600);
                $("#" + id).css("width", $("#" + id).find("img")[0].offsetWidth + 14 + "px");
            });
        }
        function CommonSet(obj, id, title) {
            if (Sys.ie) {
                TipShow(obj, "ie" + id, title);
            }
            else if (Sys.chrome) {
                TipShow(obj, "chrome" + id, title);
            }
            else if (Sys.safari) {
                TipShow(obj, "safari" + id, title);
            }
            else if (Sys.firefox) {
                TipShow(obj, "firefox" + id, title);
            }
            else {
            }
            return false;//防止页面滚动
        }
        
    </script>

    <style type="text/css">
        body{} #main{width: 98%;padding:0px 1% 0px}
        a{color:#003299;font-weight:bold;}.checkinfo-area{border:solid #aacbee 1px;font-size:14px;line-height:20px;background-color:#FFFFFF;margin:10px 4px;width:100%;}.checkinfo-area .checkinfo-area-title{overflow:hidden;border-bottom:solid #aacbee 1px;height:30px;line-height:30px;padding:0 8px;background-color:#f9fcff;background-image:linear-gradient(top,#f9fcff,#e8f1f9);}.checkinfo-area .checkinfo-area-content{padding:6px;overflow:hidden;}.check-browser-ie{display:none;}.check-browser-safari{display:none;}.check-browser-chrome{display:none;}.check-browser-firefox{display:none;}.browserInfo{}.browserRet{margin-left:20px;font-weight:bold;}.browserSuggest{margin-left:20px;}.zxlm-f14{}.zxlm-f15{font-size:18px;font-weight:bold;}
        .checkinfo-area li{ margin: 1px;}
        .result_no{color: red;font-weight:bold;}
        .result_ok{color: Green;font-weight:bold;}
        .result_error{ color: red;font-weight:bold;font-size:16px;}
        .li_sp_down{float:left; margin-left:2px;background: url("CheckIE/msdi_softdown.gif") no-repeat scroll 0 0px;font-size: 14px;padding-left: 30px;padding-right: 8px;line-height: 24px;}
        .li_sp_setting{float:left; margin-left:12px;background: url("CheckIE/msdi_setting.gif") no-repeat scroll 0 0px;font-size: 14px;padding-left: 28px;padding-right: 8px;line-height: 24px;}
        .a_setting{margin-left:8px;background: url("CheckIE/msdi_setting.gif") no-repeat scroll 0 0px;padding-left: 24px;line-height: 24px;}
        .noscript{ border:solid #aacbee 1px;background-color:#f9fcff;font-size:24px;line-heihht: 36px;margin:64px 4px;width:100%;}
    </style>
</head>
<body>
    <div id="main">
        <noscript>
            <div class="noscript">您的浏览器不支持 JavaScript脚本 无法进行检测。
            </div>
        </noscript>
        <div id="set" style="display: none; position: absolute;">
        </div>
        <div class="checkinfo-area">
            <div class="checkinfo-area-title">
                <div class="zxlm-f15">浏览器配置要求&nbsp;&nbsp;<a id="controlDisplay" value="none" controlId="checkinfoContent" href="#">显示配置要求</a></div>
            </div>
            <div class="checkinfo-area-content" id="checkinfoContent">
                <ul style="padding: 0px; margin: 0px; list-style: none;">
                    <li>为确保您可以正常使用公司的业务系统，您的浏览器需要满足以下条件：</li>
                    <li style="height:10px;"></li>
                    <li>1、要求使用 Microsoft Internet Explorer 7.0 或以上版本，如果您使用<a href="http://www.google.com/chrome" target="_blank">Google Chrome</a>或<a target="_blank" href="http://firefox.com.cn/download/" target="_blank">Mozilla Firefox</a> 则大部分系统功能将无法使用。
                        <br/>&nbsp;&nbsp;&nbsp;&nbsp;如果您使用 <!--<b><i>360安全</i></b>浏览器、<i><b>360极速</b></i>浏览器--><b><i>360</i></b>浏览器、<i><b>QQ</b></i>浏览器或<i><b>搜狗</b></i>浏览器等其他浏览器请在访问中南院业务系统时切换到“<b>兼容模式</b>”。
                    </li>                    
                    <li>2、<span style="color:#008000;"><b>推荐使用Microsoft Internet Explorer 8.0</b></span>
                        <a href="http://windows.microsoft.com/zh-CN/internet-explorer/downloads/ie-8" target="_blank">微软官方下载</a>
                        <a href="http://mis.msdi.cn/portal/install/ie/IE8-WindowsXP-x86-CHS.exe" target="_blank">本地下载(适用于XP 32位)</a></li>
                    
                    <li>3、如果使用IE浏览器，请将“<b>mis.msdi.cn</b> / <b>zny.msdi.cn</b> / <b>pmis.msdi.cn</b>”加入可信任站点，同时启用选项 "允许由脚本初始化的窗口，没有大小和位置限制"</li>
                    <li>4、IE7及以上版本把弹出窗口选项设置为"由Internet Exporer决定如何打开弹出窗口"</li>
                    
                    <li>5、允许Javascript、允许 Cookies </li>
                    <li>7、IE7及以上版本、或其他浏览器 请设置 允许弹出窗口</li>
                    <li>8、安装有 Macromedia Flash播放器 <script> document.write(FLASHMINVER);</script> 或以上版本</li>
                    <li>9、安装有 Microsoft Sliverlight 银光插件 <script> document.write(SLIVERLIGHTMINVER);</script> 或以上版本</li>
                </ul>
            </div>
        </div>
        <div id="browserInfo" class="checkinfo-area">
            <div class="checkinfo-area-title">
                <div class="zxlm-f15">浏览器配置自动检测报告&nbsp;&nbsp;<span style="color: red;">刷新窗口重新检测</span></div>
            </div>
            <div class="checkinfo-area-content">
                <div class="check-browser-ie">
                    <ul style="padding: 0px; margin: 0px; list-style: none;">
                        <li>我们正在检查您的浏览器以确定是否满足以上的要求。如果看到任何一项失败！请按照提示操作。 
                            <a href="" class="a_setting" onclick="TipShow(this,'ieadjust','注意IE的兼容模式');event.returnValue=false;">(注：由于IE兼容模式的开启可能造成浏览器版本检测不正确)</a>
                        </li>
                        <li style="height:10px;"></li>
                        <li>1、浏览器：
                            <span id="ieBrowserInfo1" class="browserInfo"></span>
                            <span id="ieBrowserRet1" class="browserRet"></span>
                            <span id="ieBrowserSuggest1_0" class="browserRet"></span>
                            <a id="ieBrowserSuggest1_1" class="browserSuggest"></a>
                            <a id="ieBrowserSuggest1_2" class="browserSuggest"></a>
                            <a id="ieBrowserSuggest1_3" class="browserSuggest"></a>
                        </li>
                        <li>2、Javascript：<span id="ieBrowserInfo2" class="browserInfo"></span><span id="ieBrowserRet2"
                                                                                                    class="browserRet"></span><a id="ieBrowserSuggest2" class="browserSuggest"></a></li>
                        <li>3、可信任站点：<span id="ieBrowserInfo3" class="browserInfo"></span><span id="ieBrowserRet3"
                                                                                               class="browserRet"></span><a id="ieBrowserSuggest3" class="browserSuggest"></a></li>
                        <li>4、允许由脚本初始化的窗口，没有大小和位置限制：<span id="ieBrowserInfo4" class="browserInfo"></span><span
                                                                                                             id="ieBrowserRet4" class="browserRet"></span><a id="ieBrowserSuggest4" class="browserSuggest"></a></li>
                        <li>5、由Internet Exporer决定如何打开弹出窗口：<span id="ieBrowserInfo5" class="browserInfo"></span><span
                                                                                                                   id="ieBrowserRet5" class="browserRet"></span><a id="ieBrowserSuggest5" class="browserSuggest"></a></li>
                        <li>6、Cookies：<span id="ieBrowserInfo6" class="browserInfo"></span><span id="ieBrowserRet6"
                                                                                                 class="browserRet"></span><a id="ieBrowserSuggest6" class="browserSuggest"></a></li>
                        <li>7、弹出窗口：<span id="ieBrowserInfo7" class="browserInfo"></span><span id="ieBrowserRet7"
                                                                                              class="browserRet"></span><a id="ieBrowserSuggest7" class="browserSuggest"></a></li>
                        <li>8、Flash播放器：<span id="ieBrowserInfo8" class="browserInfo"></span><span id="ieBrowserRet8"
                                                                                                  class="browserRet"></span><a id="ieBrowserSuggest8" class="browserSuggest"></a></li>
                        
                        <li>9、Silverlight插件：<span id="ieBrowserInfo9" class="browserInfo"></span><span id="ieBrowserRet9"
                                                                                                       class="browserRet"></span><a id="ieBrowserSuggest9" class="browserSuggest"></a></li>
                        <li>10、其他业务系统要求：<span id="ieBrowserInfo10" class="browserInfo"></span><span id="ieBrowserRet10"
                                                                                                    class="browserRet"></span><span id="ieBrowserSuggest10" class="browserSuggest">检测中...</span></li>

                        <li style="height:10px;"></li>
                        <li><img src="CheckIE/msdi_ietools.gif" width="32px"/><a id="ietools" href="" title="v2.1.0">下载常见问题修复工具(注：目前只支持对XP、Win7操作系统中的IE浏览器进行修复)</a></li>
                    </ul>
                </div>
                <div class="check-browser-chrome">
                    <ul style="padding: 0px; margin: 0px; list-style: none;">
                        <li>我们正在检查您的浏览器以确定是否满足以上的要求。如果看到任何一项失败！，请按照提示操作。 </li>
                        <li style="height:10px;"></li>
                        <li>1、浏览器：
                            <span id="chromeBrowserInfo1" class="browserInfo"></span>
                            <span id="chromeBrowserRet1" class="browserRet"></span>
                            <a id="chromeBrowserSuggest1" class="browserSuggest"></a>
                        </li>
                        <li>2、Javascript：
                            <span id="chromeBrowserInfo2" class="browserInfo"></span>
                            <span id="chromeBrowserRet2" class="browserRet"></span>
                            <a id="chromeBrowserSuggest2" class="browserSuggest"></a>
                        </li>
                        <li>3、Cookies：
                            <span id="chromeBrowserInfo3" class="browserInfo"></span>
                            <span id="chromeBrowserRet3" class="browserRet"></span>
                            <a id="chromeBrowserSuggest3" class="browserSuggest"></a>
                        </li>
                        <li>4、弹出窗口：
                            <span id="chromeBrowserInfo4" class="browserInfo"></span>
                            <span id="chromeBrowserRet4" class="browserRet"></span>
                            <a id="chromeBrowserSuggest4" class="browserSuggest"></a>
                        </li>
                        <li>5、Flash播放器：
                            <span id="chromeBrowserInfo5" class="browserInfo"></span>
                            <span id="chromeBrowserRet5" class="browserRet"></span>
                            <a id="chromeBrowserSuggest5" class="browserSuggest"></a>
                        </li>
                    </ul>
                </div>
                <div class="check-browser-firefox">
                    <ul style="padding: 0px; margin: 0px; list-style: none;">
                        <li>我们正在检查您的浏览器以确定是否满足以上的要求。如果看到任何一项失败！，请按照提示操作。 </li>
                        <li style="height:10px;"></li>
                        <li>1、浏览器：
                            <span id="firefoxBrowserInfo1" class="browserInfo"></span>
                            <span id="firefoxBrowserRet1" class="browserRet"></span>
                            <a id="fireBrowserSuggest1" class="browserSuggest"></a>
                        </li>
                        <li>2、Javascript：
                            <span id="firefoxBrowserInfo2" class="browserInfo"></span>
                            <span id="firefoxBrowserRet2" class="browserRet"></span>
                            <a id="fireBrowserSuggest2" class="browserSuggest"></a>
                        </li>
                        <li>3、Cookies：
                            <span id="firefoxBrowserInfo3" class="browserInfo"></span>
                            <span id="firefoxBrowserRet3" class="browserRet"></span>
                            <a id="fireBrowserSuggest3" class="browserSuggest"></a>
                        </li>
                        <li>4、弹出窗口：
                            <span id="firefoxBrowserInfo4" class="browserInfo"></span>
                            <span id="firefoxBrowserRet4" class="browserRet"></span>
                            <a id="fireBrowserSuggest4" class="browserSuggest"></a>
                        </li>
                        <li>5、Flash播放器：
                            <span id="firefoxBrowserInfo5" class="browserInfo"></span>
                            <span id="firefoxBrowserRet5" class="browserRet"></span>
                            <a id="fireBrowserSuggest5" class="browserSuggest"></a>
                        </li>
                    </ul>
                </div>
                <div class="check-browser-safari">
                    <ul style="padding: 0px; margin: 0px; list-style: none;">
                        <li>我们正在检查您的浏览器以确定是否满足以上的要求。如果看到任何一项失败！，请按照提示操作。 </li>
                        <li style="height:10px;"></li>
                        <li>1、浏览器：<span id="safariBrowserInfo1" class="browserInfo"></span><span id="safariBrowserRet1" class="browserRet"></span><a
                                                                                                                                                      id="safariBrowserSuggest1" class="browserSuggest"></a></li>
                        <li>2、Javascript：<span id="safariBrowserInfo2" class="browserInfo"></span><span id="safariBrowserRet2" class="browserRet"></span><a
                                                                                                                                                             id="safariBrowserSuggest2" class="browserSuggest"></a></li>
                        <li>3、Cookies：<span id="safariBrowserInfo3" class="browserInfo"></span><span id="safariBrowserRet3" class="browserRet"></span><a
                                                                                                                                                          id="safariBrowserSuggest3" class="browserSuggest"></a></li>
                        <li>4、弹出窗口：<span id="safariBrowserInfo4" class="browserInfo"></span><span id="safariBrowserRet4" class="browserRet"></span><a
                                                                                                                                                       id="safariBrowserSuggest4" class="browserSuggest"></a></li>
                        <li>5、Flash播放器：<span id="safariBrowserInfo5" class="browserInfo"></span><span id="safariBrowserRet5" class="browserRet"></span><a
                                                                                                                                                           id="safariBrowserSuggest5" class="browserSuggest"></a></li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div id="browserSet" class="checkinfo-area">
            <div class="checkinfo-area-title">
                <div class="zxlm-f14">
                    基本配置说明</div>
            </div>
            <div class="checkinfo-area-content">
                <ul style="padding: 0px; margin: 0px; list-style: none;">
                    <li class="li_sp_setting"><a onclick="CommonSet(this,'jsset','允许Javascript');event.returnValue=false;" href="">允许Javascript</a></li>
                    <li class="li_sp_down"><a href="http://get.adobe.com/cn/flashplayer/" target="_blank">安装Macromedia Flash播放器</a></li>
                    <li class="li_sp_down"><a href="http://www.microsoft.com/getsilverlight/Get-Started/Install/" target="_blank">安装 Sliverlight</a></li>
                    <li class="li_sp_setting"><a onclick="CommonSet(this,'cookieset','允许Cookies');event.returnValue=false;" href="">允许Cookies</a></li>
                    <li class="li_sp_setting"><a onclick="CommonSet(this,'popupset','允许弹出窗口');event.returnValue=false;" href="">允许弹出窗口</a></li>
                </ul>
            </div>
        </div>
        <div id="browserOcx" class="checkinfo-area">
            <div class="checkinfo-area-title">
                <div class="zxlm-f14">
                    系统常用插件</div>
            </div>
            <div class="checkinfo-area-content">
                <ul style="padding: 0px; margin: 0px; list-style: none;">
                    <!--1.2 简化安装组件-->
                    <li class="li_sp_down"><a href="http://mis.msdi.cn/Portal/install/Office/iSignatureASM.exe" target="_blank">下载电子签章安全软件</a></li>
                    <li class="li_sp_down"><a href="http://mis.msdi.cn/Portal/install/Baisc.EXE" target="_blank">下载MIS系统插件</a></li>
                    <li class="li_sp_down"><a href="http://mis.msdi.cn/Portal/install/flashplayer15_install_win.exe"  target="_blank" title="通过院内网服务器下载安装文件，IE，X86">下载Flash安装包</a></li>
                    <!--5.1.30214.0-->
                    <li class="li_sp_down"><a href="http://mis.msdi.cn/Portal/install/Office/Silverlight5.exe" target="_blank">下载Sliverlight5安装文件</a></li>
                    <li class="li_sp_down"><a href="http://www.microsoft.com/zh-cn/download/details.aspx?id=1639" target="_blank">安装.NET运行框架</a></li>

                    <!--TODO 部署金格的示例代码于服务器-->
                    <!--<li style="float:left; margin-left:10px;"><a href="http://mis.msdi.cn:8080/coa/axis2-admin/office.jsp" target="_blank">OFFICE在线编辑工具</a></li>-->

                </ul>
            </div>
        </div>
    </div>
</body>
</html>
<script>

    //其他业务系统检测
    function OtherSystemCheck(browser, index) {
        var checkResult = true;
        var checkStatusArr = new Array();
        var helpHtml = "";

        var showResult = function (ditem, data) {
            if (!(ditem && data)) {
                return;
            }
            if (checkStatusArr.length == 0)
                helpHtml += "<br/><ul>";

            if (data) {
                //alert(data);
                var rJson, isPassed = true;
                eval("rJson=" + data);

                var itemHelpHtml = "";
                if (rJson && rJson.length > 0) {
                    //helpHtml += data;
                    var itemsPassed = true;
                    for (var ii = 0; ii < rJson.length; ii++) {
                        var jsonItem = rJson[ii];
                        if (!jsonItem.value) {
                            isPassed = false; itemsPassed = false;
                            itemHelpHtml += "&nbsp;" + CheckItemLang[jsonItem.key] + "检测 <span class=\"result_no\">未通过</span>&nbsp;";
                        }
                    }
                    if (itemsPassed) {
                        itemHelpHtml = "<li><b>" + ditem.name + "</b>&nbsp;&nbsp;检测 <span class=\"result_ok\">通过</span> ";
                    } else {
                        itemHelpHtml = "<li><b>" + ditem.name + "</b>&nbsp;&nbsp;存在的浏览器设置问题：" + itemHelpHtml;
                    }
                } else {
                    itemHelpHtml += "<li><b>" + ditem.name + "</b>&nbsp;&nbsp;存在的浏览器设置问题：检测时<span class=\"result_error\">发生错误</span>。";
                    isPassed = false;
                }

                if (!isPassed && (ditem.helpMsg || ditem.helpUrl)) {
                    itemHelpHtml += " 如有疑问请 " + (ditem.helpMsg ? ditem.helpMsg : "") +
                        (ditem.helpUrl ? " 访问<a href='" + ditem.helpUrl + "' target='_blank'>帮助页面</a>" : "");
                }
                itemHelpHtml += "</li>";
                if (!isPassed) {
                    checkResult = false;
                }
                helpHtml += itemHelpHtml;
            }
            checkStatusArr.push(item.key);


            if (checkStatusArr.length == Domains.length) {
                if (checkResult) { // true/false
                    $("#" + browser + "BrowserRet" + index).html("成功");
                    $("#" + browser + "BrowserRet" + index).css("color", "#008000");
                    $("#" + browser + "BrowserSuggest" + index).html(helpHtml);
                }
                else {
                    $("#" + browser + "BrowserRet" + index).html("失败");
                    $("#" + browser + "BrowserRet" + index).css("color", "red");

                    $("#" + browser + "BrowserSuggest" + index).html(helpHtml);
                }
            }
        };

        for (var i = 0; i < Domains.length; i++) {
            var item = Domains[i];
            if (item.checkUrl) {
                //并发处理
                //var func = function () { init(showResult, item); };
                //window.setTimeout(func, 32 * i);
                init(showResult, item);
            }
        }


    }

    function init(callback,item) {
        var iframeProxy = document.createElement('iframe');
        var state = 0;
        var loadfn = function () {
            if (state === 1) {
                var data = iframeProxy.contentWindow.name; // 读取数据
                callback(item,data); //弹出返回值
                
                if (iframeProxy) {
                    if (iframeProxy.detachEvent) {//判断是否是IE
                        iframeProxy.detachEvent('onload', loadfn);
                    }
                    iframeProxy.contentWindow.document.write('');
                    iframeProxy.contentWindow.close();
                    document.body.removeChild(iframeProxy);
                }
            } else if (state === 0) {
                state = 1;
                iframeProxy.contentWindow.location = ContextPath + "proxy.html"; // 设置的代理文件
            }
        };

        iframeProxy.src = item.checkUrl;
        //iframeProxy.style.display = "none"; //隐藏窗口
        iframeProxy.height = 120;
        iframeProxy.width = 200;

        if (iframeProxy.attachEvent) {//判断是否为IE
            iframeProxy.attachEvent('onload', loadfn);
        } else {
            iframeProxy.onload = loadfn;
        }
        document.body.appendChild(iframeProxy);
    }

    function SetResultCookies(value) {
        $.cookie("_BCCheck", value, { expires: 32 , path: '/'});
    }

    $(document).ready(function () {
        $("#" + $("#controlDisplay").attr("controlId")).hide();
        $("#controlDisplay").text("显示配置要求").val("none").click(function () {
            var id = $(this).attr("controlId");
            if ($(this).val() == "none") {
                //隐藏
                $(this).val("block");
                $(this).text("隐藏");
                $("#" + id).show();
            } else {
                $(this).val("none");
                $(this).text("显示配置要求");
                $("#" + id).hide();
            }
            return false;
        });

        //自动修复工具的运行 .net运行时环境的支持
        $("#ietools").click(function () {
            if ($.ua().isIe && $.ua().ua.indexOf(".net clr") > 0) {
                //alert("已经安装.net运行时");
            } else {
                if (!confirm("您的电脑可能尚未安装.NET运行框架，将造成修复工具无法运行。您确定继续下载“自动修复工具”吗？\n 选择“确定”下载工具，选择“取消”下载.NET运行框架。")) {
                    //弹出下载 .NET框架的界面
                    //window.open("http://www.microsoft.com/zh-cn/download/details.aspx?id=1639", "dotnet2");
                    window.open("http://download.microsoft.com/download/c/6/e/c6e88215-0178-4c6c-b5f3-158ff77b1f38/NetFx20SP2_x86.exe", "dotnet2"); //23.8 MB
                }
            }
            //window.open(ContextPath + "/Portal/install/MSDI_IETool.exe", "MSDI_IETool", "width=320,height=160");
            //window.open("http://mis.msdi.cn/Portal/install/MSDI_IETool.exe", "MSDI_IETool", "width=320,height=160");
            window.open("http://mis.msdi.cn/Portal/install/Download.aspx?Id=MSDI_IETool.exe", "MSDI_IETool", "width=320,height=160");
            return false;
        });

//        if ($.ua().isIe && document.mimeType !== undefined
//            && document.mimeType.indexOf("Chrome") == 0 //设置Chrome为默认浏览器后的现象
//        ) {
//            alert("您正在使用 360浏览器。");
//        }

        $.blockUI({ css: {
            border: 'none',
            padding: '15px',
            backgroundColor: '#000',
            '-webkit-border-radius': '10px',
            '-moz-border-radius': '10px',
            opacity: .5,
            color: '#fff'
        },
            message: '正在检测您的浏览器配置情况，请稍候......',
            timeout: 4000
        });
        //需要通过回调进行特殊处理，否则屏蔽层的效果不明显
        var callFunc = function () {
            console.log("初始化成功");
            InitialInfo();
            setTimeout($.unblockUI, 500);
        };
        setTimeout(callFunc, 200);
    });
</script>